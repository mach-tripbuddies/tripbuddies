"use strict";(self.webpackChunktripbuddies_cms=self.webpackChunktripbuddies_cms||[]).push([[3578],{38857:(je,F,s)=>{s.r(F),s.d(F,{default:()=>ge});var e=s(92132),a=s(55506),i=s(21272),p=s(94061),M=s(12081),N=s(12408),E=s(24093),O=s(35513),D=s(25641),R=s(85963),U=s(26127),K=s(90361),c=s(33363),P=s(98765),x=s(30893),J=s(54894),G=s(60414),b=s.n(G);const C=()=>{const{formatMessage:n}=(0,J.A)();return{i18n:(r,j)=>n({id:`${b()}.${r}`,defaultMessage:j})}};var I=s(67219);const B=()=>{const{i18n:n}=C();return(0,e.jsx)(U.d,{children:(0,e.jsxs)(K.Tr,{children:[(0,e.jsx)(a.d4,{permissions:I.J.createAndDelete,children:(0,e.jsx)(c.Th,{children:(0,e.jsx)(P.s,{children:"INDEX"})})}),(0,e.jsx)(c.Th,{children:(0,e.jsx)(x.o,{variant:"sigma",children:n("plugin.table.header.name","NAME")})}),(0,e.jsx)(c.Th,{children:(0,e.jsx)(x.o,{variant:"sigma",children:n("plugin.table.header.in-meilisearch","IN MEILISEARCH ?")})}),(0,e.jsx)(c.Th,{children:(0,e.jsx)(x.o,{variant:"sigma",children:n("plugin.table.header.indexing","INDEXING ?")})}),(0,e.jsx)(c.Th,{children:(0,e.jsx)(x.o,{variant:"sigma",children:n("plugin.table.header.index-name","INDEX NAME")})}),(0,e.jsx)(c.Th,{children:(0,e.jsx)(x.o,{variant:"sigma",children:n("plugin.table.header.documents","DOCUMENTS")})}),(0,e.jsx)(c.Th,{children:(0,e.jsx)(x.o,{variant:"sigma",children:n("plugin.table.header.hooks","HOOKS")})}),(0,e.jsx)(a.d4,{permissions:I.J.update,children:(0,e.jsx)(c.Th,{children:(0,e.jsx)(P.s,{children:"Actions"})})})]})})},X=(0,i.memo)(B);var W=s(50215),Y=s(83997);const w=({entry:n,deleteCollection:h,addCollection:r,updateCollection:j})=>{const{i18n:l}=C();return(0,e.jsxs)(K.Tr,{children:[(0,e.jsx)(a.d4,{permissions:I.J.createAndDelete,children:(0,e.jsx)(c.Td,{children:(0,e.jsx)(W.J,{"aria-label":`Select ${n.collection}`,onValueChange:()=>{n.indexed?h({contentType:n.contentType}):r({contentType:n.contentType})},value:n.indexed})})}),(0,e.jsx)(c.Td,{children:(0,e.jsx)(x.o,{textColor:"neutral800",children:n.collection})}),(0,e.jsx)(c.Td,{children:(0,e.jsx)(x.o,{textColor:"neutral800",children:n.indexed?l("plugin.table.td.yes","Yes"):l("plugin.table.td.no","No")})}),(0,e.jsx)(c.Td,{children:(0,e.jsx)(x.o,{textColor:"neutral800",children:n.isIndexing?l("plugin.table.td.yes","Yes"):l("plugin.table.td.no","No")})}),(0,e.jsx)(c.Td,{children:(0,e.jsx)(x.o,{textColor:"neutral800",children:n.indexUid})}),(0,e.jsx)(c.Td,{children:(0,e.jsxs)(x.o,{textColor:"neutral800",children:[n.numberOfDocuments," / ",n.numberOfEntries]})}),(0,e.jsx)(c.Td,{children:(0,e.jsx)(x.o,{textColor:"neutral800",children:n.reloadNeeded})}),(0,e.jsx)(a.d4,{permissions:I.J.update,children:(0,e.jsx)(c.Td,{children:(0,e.jsx)(Y.s,{children:(0,e.jsx)(p.a,{paddingLeft:1,children:n.indexed&&(0,e.jsx)(R.$,{onClick:()=>j({contentType:n.contentType}),size:"S",variant:"secondary",children:l("plugin.update","Update")})})})})})]},n.contentType)},z=(0,i.memo)(w);function V(){const n=(0,a.hN)(),{i18n:h}=C();function r({type:l="info",message:g=h("plugin.message.something","Something occured in Meilisearch"),link:o,blockTransition:m=!0,title:d}){n({title:d,type:l,message:{id:"notification.meilisearch.message",defaultMessage:g},link:o,blockTransition:m,onClose:()=>localStorage.setItem("STRAPI_UPDATE_NOTIF",!0)})}return{handleNotification:r,checkForbiddenError:({response:l})=>{const g=l?.payload?.error?.status;g&&g===403&&r({title:h("plugin.message.forbidden.title","Forbidden"),type:"warning",message:h("plugin.message.forbidden.description","You do not have permission to do this action"),blockTransition:!1})}}}const $=V;function Q(){const[n,h]=(0,i.useState)([]),[r,j]=(0,i.useState)(!0),[l,g]=(0,i.useState)(!1),[o,m]=(0,i.useState)(!1),{handleNotification:d,checkForbiddenError:k}=$(),{i18n:T}=C(),v=()=>j(u=>!u),S=({indexed:u,listened:t})=>u&&t?T("plugin.table.td.hookingText.hooked","Hooked"):!u&&!t?"/":T("plugin.table.td.hookingText.reload","Reload needed"),f=async()=>{const{data:u,error:t}=await(0,a.l1)(`/${b()}/content-type/`,{method:"GET"});if(t)d({type:"warning",message:t.message,link:t.link});else{const H=u.contentTypes.map(A=>(A.reloadNeeded=S({indexed:A.indexed,listened:A.listened}),A)),me=H.find(A=>A.reloadNeeded===T("plugin.table.td.hookingText.reload","Reload needed")),fe=H.find(A=>A.isIndexing===!0);m(!!fe),g(!!me),h(H)}},y=async({contentType:u})=>{try{const{error:t}=await(0,a.l1)(`/${b()}/content-type/${u}`,{method:"DELETE"});t?d({type:"warning",message:t.message,link:t.link}):(v(),d({type:"success",message:T("plugin.message.success.delete","Request to delete content-type is successful"),blockTransition:!1}))}catch(t){k(t)}},pe=async({contentType:u})=>{try{const{error:t}=await(0,a.l1)(`/${b()}/content-type`,{method:"POST",body:{contentType:u}});t?d({type:"warning",message:t.message,link:t.link}):(v(),d({type:"success",message:T("plugin.message.success.add","Request to add a content-type is successful"),blockTransition:!1}))}catch(t){k(t)}},xe=async({contentType:u})=>{try{const{error:t}=await(0,a.l1)(`/${b()}/content-type`,{method:"PUT",body:{contentType:u}});t?d({type:"warning",message:t.message,link:t.link}):(v(),d({type:"success",message:T("plugin.message.success.update","Request to update content-type is successful"),blockTransition:!1}))}catch(t){k(t)}};return(0,i.useEffect)(()=>{f()},[r]),(0,i.useEffect)(()=>{let u;return o?u=setInterval(()=>{v()},1e3):clearInterval(u),()=>clearInterval(u)},[o]),{collections:n,deleteCollection:y,addCollection:pe,updateCollection:xe,reloadNeeded:l,refetchCollection:v,handleNotification:d}}const Z=Q,q=()=>{const{collections:n,deleteCollection:h,addCollection:r,updateCollection:j,reloadNeeded:l,refetchCollection:g}=Z(),{lockAppWithAutoreload:o,unlockAppWithAutoreload:m}=(0,a.Ip)(),[d,k]=(0,i.useState)(!1),{i18n:T}=C(),v=6,S=10,f=async()=>{try{o(),await(0,a.l1)(`/${b()}/reload`,{method:"GET"},!0),k(!1)}catch(y){console.error(y)}finally{m(),g()}};return(0,i.useEffect)(()=>{d&&f()},[d]),(0,e.jsxs)(p.a,{background:"neutral100",children:[(0,e.jsxs)(O.X,{colCount:S,rowCount:v,children:[(0,e.jsx)(X,{}),(0,e.jsx)(D.N,{children:n.map(y=>(0,e.jsx)(z,{entry:y,deleteCollection:h,addCollection:r,updateCollection:j},y.collection))})]}),l&&(0,e.jsx)(p.a,{padding:5,children:(0,e.jsx)(R.$,{onClick:()=>k(!0),children:T("plugin.reload-server","Reload server")})})]})},_=(0,i.memo)(q);var L=s(7537);function ee(){const[n,h]=(0,i.useState)({host:"",apiKey:"",ApiKeyIsFromConfigFile:!0,HostIsFromConfigFile:!0}),[r,j]=(0,i.useState)(!0),[l,g]=(0,i.useState)(""),[o,m]=(0,i.useState)(""),{handleNotification:d}=$(),{i18n:k}=C(),T=()=>j(f=>!f),v=async()=>{const{error:f}=await(0,a.l1)(`/${b()}/credential`,{method:"POST",body:{apiKey:o,host:l}});f?d({type:"warning",message:f.message,link:f.link}):(T(),d({type:"success",message:k("plugin.message.success.credentials","Credentials sucessfully updated!"),blockTransition:!1}))},S=async()=>{const{data:f,error:y}=await(0,a.l1)(`/${b()}/credential`,{method:"GET"});y?d({type:"warning",message:y.message,link:y.link}):(h(f),g(f.host),m(f.apiKey))};return(0,i.useEffect)(()=>{S()},[r]),{credentials:n,updateCredentials:v,setHost:g,setApiKey:m,host:l,apiKey:o}}const Te=null,ne=()=>{const{host:n,apiKey:h,credentials:r,setHost:j,setApiKey:l,updateCredentials:g}=ee(),{i18n:o}=C();return(0,e.jsxs)(p.a,{children:[(0,e.jsx)(p.a,{padding:2,children:(0,e.jsx)(L.k,{placeholder:o("plugin.tab.settings.input.url.placeholder","URL"),label:o("plugin.tab.settings.input.url.label","Meilisearch URL"),name:"host",hint:o("plugin.tab.settings.input.url.hint","The URL on which your Meilisearch is running"),value:n,onChange:m=>j(m.target.value),disabled:r.HostIsFromConfigFile})}),(0,e.jsx)(p.a,{padding:2,children:(0,e.jsx)(L.k,{placeholder:o("plugin.tab.settings.input.apiKey.placeholder","API key"),label:o("plugin.tab.settings.input.apiKey.label","Meilisearch API Key"),name:"apiKey",hint:o("plugin.tab.settings.input.apiKey.hint","A valid API key with enough permission to create indexes (or the master key)."),onChange:m=>l(m.target.value),value:h,disabled:r.ApiKeyIsFromConfigFile,"aria-label":"Password",type:"password"})}),(0,e.jsx)(p.a,{paddingTop:1,paddingLeft:2,children:(0,e.jsxs)(x.o,{variant:"pi",style:{color:"red"},children:[o("plugin.tab.settings.warning.credentials.1","Do not use this API key on your front-end as it has too much rights. Instead, use the public key available using")," ",(0,e.jsx)("a",{href:"https://www.meilisearch.com/docs/reference/api/keys#get-keys",target:"_blank",rel:"noreferrer",children:o("plugin.tab.settings.warning.credentials.2","the key route")}),"."]})}),(0,e.jsx)(p.a,{paddingTop:2,paddingLeft:2,paddingRight:2,paddingBottom:2,children:(0,e.jsx)(a.d4,{permissions:I.J.settingsEdit,children:(0,e.jsx)(R.$,{variant:"secondary",onClick:()=>g(),disabled:r.ApiKeyIsFromConfigFile&&r.HostIsFromConfigFile,children:o("plugin.save","Save")})})})]})},se=(0,i.memo)(ne),te=()=>(0,e.jsx)(p.a,{padding:5,children:(0,e.jsx)(se,{})}),ie=(0,i.memo)(te),oe=()=>{const{i18n:n}=C();return(0,e.jsx)(p.a,{padding:8,margin:10,background:"neutral",children:(0,e.jsxs)(M.f,{label:"Some stuff for the label",id:"tabs",children:[(0,e.jsxs)(N.t,{children:[(0,e.jsx)(N.o,{children:n("plugin.tab.collections","Collections")}),(0,e.jsx)(N.o,{children:n("plugin.tab.settings","Settings")})]}),(0,e.jsxs)(E.T,{children:[(0,e.jsx)(E.K,{children:(0,e.jsx)(a.d4,{permissions:I.J.collections,children:(0,e.jsx)(p.a,{color:"neutral800",padding:4,background:"neutral0",children:(0,e.jsx)(_,{})})})}),(0,e.jsx)(E.K,{children:(0,e.jsx)(a.d4,{permissions:I.J.settings,children:(0,e.jsx)(p.a,{color:"neutral800",padding:4,background:"neutral0",children:(0,e.jsx)(ie,{})})})})]})]})})},le=(0,i.memo)(oe);var ae=s(55356),re=s(64871),de=s(46270);const ce=()=>{const{i18n:n}=C();return(0,e.jsx)(p.a,{background:"neutral100",children:(0,e.jsx)(ae.$,{navigationAction:(0,e.jsx)(re.N,{startIcon:(0,e.jsx)(de.A,{}),to:"/",children:n("plugin.go-back","Go Back")}),title:n("plugin.name","Meilisearch"),subtitle:n("plugin.description","Search in your content-types with the Meilisearch plugin"),as:"h2"})})},ue=(0,i.memo)(ce),he=()=>(0,e.jsx)(a.kz,{permissions:I.J.main,children:(0,e.jsxs)("div",{children:[(0,e.jsx)(ue,{}),(0,e.jsx)(le,{})]})}),ge=(0,i.memo)(he)}}]);
